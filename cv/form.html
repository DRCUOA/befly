<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#000000">
  <title>CV Enrichment</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --safe-top: env(safe-area-inset-top, 0);
      --safe-bottom: env(safe-area-inset-bottom, 0);
      --touch-min: 48px;
      --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    * { -webkit-tap-highlight-color: transparent; }
    html, body {
      height: 100%;
      overflow: hidden;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;
    }
    body {
      padding: 0;
      margin: 0;
      padding-top: var(--safe-top);
      padding-bottom: calc(var(--safe-bottom) + 80px);
      background: #f2f2f7;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    .screen {
      position: absolute;
      inset: 0;
      padding: 16px;
      padding-top: max(16px, var(--safe-top));
      display: flex;
      flex-direction: column;
      opacity: 0;
      pointer-events: none;
      transform: translateX(100%);
      transition: opacity var(--transition), transform var(--transition);
    }
    .screen.active {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(0);
    }
    .screen.prev { transform: translateX(-30%); }
    .screen.next { transform: translateX(30%); }
    .progress-bar {
      height: 4px;
      background: rgba(0,0,0,0.08);
      border-radius: 2px;
      margin-bottom: 24px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: #007AFF;
      border-radius: 2px;
      transition: width var(--transition);
    }
    .progress-text {
      font-size: 13px;
      color: #8e8e93;
      margin-bottom: 8px;
    }
    .question-text {
      font-size: 22px;
      font-weight: 600;
      line-height: 1.3;
      color: #1d1d1f;
      margin-bottom: 24px;
      letter-spacing: -0.02em;
    }
    .options-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .option-btn {
      display: flex;
      align-items: center;
      min-height: var(--touch-min);
      padding: 16px 20px;
      background: #fff;
      border: none;
      border-radius: 12px;
      font-size: 17px;
      text-align: left;
      color: #1d1d1f;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      -webkit-tap-highlight-color: transparent;
    }
    .option-btn:active { transform: scale(0.98); }
    .option-btn.selected {
      background: #007AFF;
      color: #fff;
      box-shadow: 0 2px 8px rgba(0,122,255,0.35);
    }
    .option-btn input { display: none; }
    .option-btn .check { margin-left: auto; opacity: 0; }
    .option-btn.selected .check { opacity: 1; }
    .option-btn.multi .check { display: none; }
    .option-btn.multi.selected .check { display: block; }
    .text-input {
      width: 100%;
      min-height: 120px;
      padding: 16px 20px;
      font-size: 17px;
      border: none;
      border-radius: 12px;
      background: #fff;
      resize: none;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    .text-input:focus { outline: none; box-shadow: 0 0 0 2px #007AFF; }
    .nav-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: calc(72px + var(--safe-bottom));
      padding-bottom: var(--safe-bottom);
      padding: 12px 16px;
      background: #f2f2f7;
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      border-top: 1px solid rgba(0,0,0,0.06);
    }
    .nav-btn {
      flex: 1;
      min-height: var(--touch-min);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 17px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
      -webkit-tap-highlight-color: transparent;
    }
    .nav-btn:active { transform: scale(0.98); }
    .nav-btn.back {
      flex: 0 0 auto;
      min-width: 56px;
      background: transparent;
      color: #007AFF;
    }
    .nav-btn.next {
      background: #007AFF;
      color: #fff;
    }
    .nav-btn.next:disabled {
      background: #c7c7cc;
      color: #8e8e93;
      cursor: not-allowed;
    }
    .nav-btn.submit { background: #34C759; color: #fff; }
    .welcome-screen .question-text { font-size: 20px; }
    .welcome-screen .options-list { justify-content: center; }
    .done-screen .question-text { text-align: center; margin-top: 2rem; }
    .done-screen .subtext { font-size: 15px; color: #8e8e93; text-align: center; margin-top: 8px; }
    .follow-up-wrap {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(0,0,0,0.06);
    }
    .follow-up-wrap input {
      width: 100%;
      padding: 16px 20px;
      font-size: 17px;
      border: none;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    .salary-row {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }
    .salary-row input, .salary-row select {
      flex: 1;
      padding: 16px;
      font-size: 17px;
      border: none;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    @media (min-width: 768px) {
      body { max-width: 420px; margin: 0 auto; }
      .nav-bar { max-width: 420px; left: 50%; transform: translateX(-50%); }
    }
  </style>
</head>
<body>
  <div id="screens"></div>
  <nav class="nav-bar d-none" id="nav-bar">
    <button type="button" class="nav-btn back" id="btn-back" aria-label="Back">
      <i class="bi bi-chevron-left"></i>
    </button>
    <button type="button" class="nav-btn next" id="btn-next" aria-label="Next">
      Next <i class="bi bi-chevron-right"></i>
    </button>
  </nav>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let QUESTIONS_DATA = {"candidate":"Moira Clark","questions":[{"id":"q_role_preferences","category":"role_preferences","expected_type":"array","question":"What type of role are you seeking?","options":["HR Business Partner","People & Culture Lead","Product Owner","Talent/Recruitment Manager","Strategic People Partner","HR Operations","Other"]},{"id":"q_seniority","category":"role_preferences","expected_type":"string","question":"What seniority level are you targeting?","options":["Individual Contributor","Team Lead","Manager","Senior Manager","Director","Head of","Executive"]},{"id":"q_work_arrangement","category":"work_arrangement","expected_type":"string","question":"What work arrangement do you prefer?","options":["On-site","Hybrid (specify days)","Remote","Flexible"],"follow_up":"How many days on-site per week?"},{"id":"q_location","category":"work_arrangement","expected_type":"array","question":"Where are you open to working?","options":["Auckland only","NZ-wide","Australia","Remote internationally"]},{"id":"q_relocation","category":"work_arrangement","expected_type":"boolean","question":"Are you open to relocating for the right opportunity?","options":["Yes","No"]},{"id":"q_contract_type","category":"employment_type","expected_type":"array","question":"What employment type are you seeking?","options":["Permanent","Fixed-term contract","Contract/Temporary","Part-time","Consulting"]},{"id":"q_availability","category":"employment_type","expected_type":"string","question":"When are you available to start?","options":["Immediately","2 weeks notice","1 month","2-3 months","Flexible"]},{"id":"q_industries","category":"sector_preferences","expected_type":"array","question":"Which sectors or industries interest you?","options":["Public sector / Government","Housing / Property","Technology","Financial services","Healthcare","Education","NFP / Community","Corporate / Private sector","Start-up / Scale-up","Other"]},{"id":"q_industries_exclude","category":"sector_preferences","expected_type":"array","question":"Any industries you would prefer to avoid?","options":[]},{"id":"q_org_size","category":"sector_preferences","expected_type":"string","question":"What organisation size do you prefer?","options":["Start-up (< 50)","SME (50-200)","Mid-size (200-1000)","Large (1000+)","Enterprise (5000+)","No preference"]},{"id":"q_tech_stack","category":"skills_enrichment","expected_type":"array","question":"Which HR/People systems are you proficient in?","options":[]},{"id":"q_certifications","category":"skills_enrichment","expected_type":"array","question":"Do you hold any professional certifications?","options":[]},{"id":"q_metrics","category":"skills_enrichment","expected_type":"object","question":"Can you quantify any key achievements?","options":[]},{"id":"q_career_goals","category":"motivation","expected_type":"string","question":"What are you looking for in your next role?","options":[]},{"id":"q_deal_breakers","category":"motivation","expected_type":"array","question":"What would be a deal-breaker for you?","options":[]},{"id":"q_values","category":"motivation","expected_type":"array","question":"What organisational values are most important to you?","options":[]},{"id":"q_salary","category":"compensation","expected_type":"object","question":"What is your salary expectation range? (Optional)","options":[]},{"id":"q_visa","category":"eligibility","expected_type":"string","question":"What is your work eligibility status in NZ?","options":["NZ Citizen","NZ Permanent Resident","Work Visa","Requires sponsorship"]},{"id":"q_languages","category":"eligibility","expected_type":"array","question":"What languages do you speak?","options":[]},{"id":"q_te_ao_maori","category":"skills_enrichment","expected_type":"string","question":"Your level of familiarity with te ao MÄori in the workplace?","options":["Beginner","Developing","Proficient","Advanced","Prefer not to say"]}]};

    const CATEGORY_LABELS = { role_preferences:'Role', work_arrangement:'Work', employment_type:'Employment', sector_preferences:'Sector', skills_enrichment:'Skills', motivation:'Values', compensation:'Compensation', eligibility:'Eligibility' };

    let currentIdx = -1;
    let responses = {};
    let screens = [];

    function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

    function renderScreen(q, idx) {
      const div = document.createElement('div');
      div.className = 'screen' + (idx === 0 ? ' welcome-screen' : '') + (q.id === 'done' ? ' done-screen' : '');
      div.dataset.idx = idx;
      div.dataset.qid = q.id;

      const progress = idx === 0 ? '' : `<div class="progress-text">${idx} of ${screens.length - 2}</div><div class="progress-bar"><div class="progress-fill" style="width:${(idx/(screens.length-1))*100}%"></div></div>`;
      div.innerHTML = `<div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div><div class="question-text">${esc(q.question)}</div><div class="options-list"></div>`;

      const opts = div.querySelector('.options-list');
      const fill = div.querySelector('.progress-fill');

      if (idx > 0) {
        div.querySelector('.progress-bar').insertAdjacentHTML('beforebegin', `<div class="progress-text">${idx} of ${screens.length - 2}</div>`);
        fill.style.width = (idx / (screens.length - 1)) * 100 + '%';
      } else {
        div.querySelector('.progress-bar').remove();
      }

      if (q.id === 'welcome') {
        div.querySelector('.question-text').innerHTML = 'Help us match you to the right opportunities. A few quick questions.';
        opts.innerHTML = '<div style="text-align:center;color:#8e8e93;font-size:15px;">Tap Next to begin</div>';
      } else if (q.id === 'done') {
        div.querySelector('.question-text').textContent = "You're all set!";
        div.querySelector('.options-list').innerHTML = '<p class="subtext">Tap Submit to download your responses.</p>';
      } else if (q.expected_type === 'boolean' || (q.expected_type === 'string' && q.options && q.options.length)) {
        (q.options || ['Yes','No']).forEach(opt => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'option-btn' + (q.expected_type === 'array' ? ' multi' : '');
          btn.innerHTML = esc(opt) + '<i class="bi bi-check-lg check"></i>';
          btn.dataset.value = opt;
          if (q.expected_type === 'array') {
            btn.addEventListener('click', () => { btn.classList.toggle('selected'); });
          } else {
            btn.addEventListener('click', () => { opts.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected')); btn.classList.add('selected'); });
          }
          opts.appendChild(btn);
        });
        if (q.follow_up) {
          const fu = document.createElement('div');
          fu.className = 'follow-up-wrap d-none';
          fu.id = q.id + '_fu';
          fu.innerHTML = `<label class="d-block mb-2" style="font-size:15px;color:#8e8e93">${esc(q.follow_up)}</label><input type="text" name="${q.id}_followup" placeholder="e.g. 2 days">`;
          opts.appendChild(fu);
          opts.querySelectorAll('.option-btn').forEach(b => {
            b.addEventListener('click', () => { fu.classList.toggle('d-none', (b.dataset.value || '').indexOf('Hybrid') < 0); });
          });
        }
      } else if (q.expected_type === 'array' && q.options && q.options.length) {
        q.options.forEach(opt => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'option-btn multi';
          btn.innerHTML = esc(opt) + '<i class="bi bi-check-lg check"></i>';
          btn.dataset.value = opt;
          btn.addEventListener('click', () => { btn.classList.toggle('selected'); });
          opts.appendChild(btn);
        });
      } else if (q.id === 'q_salary') {
        opts.innerHTML = `<div class="salary-row"><input type="text" name="${q.id}_min" placeholder="Min" inputmode="numeric"><input type="text" name="${q.id}_max" placeholder="Max" inputmode="numeric"></div><div class="salary-row"><select name="${q.id}_currency"><option value="NZD">NZD</option><option value="AUD">AUD</option></select><select name="${q.id}_includes_super"><option value="no">Excl. super</option><option value="yes">Incl. super</option></select></div>`;
      } else {
        const ta = document.createElement('textarea');
        ta.className = 'text-input';
        ta.name = q.id;
        ta.placeholder = q.id.includes('tech') ? 'e.g. Service Now, JIRA, Workday' : q.id.includes('cert') ? 'e.g. CIPD, SHRM' : q.id.includes('metrics') ? 'e.g. Led team of 12; Hired 100+/month' : q.id.includes('industries_exclude') ? 'Comma-separated' : '';
        opts.appendChild(ta);
      }
      return div;
    }

    async function init() {
      try {
        const r = await fetch('clarification-questions.json');
        if (r.ok) {
          const data = await r.json();
          if (data.questions) QUESTIONS_DATA = data;
        }
      } catch (_) {}
      const qs = [{ id: 'welcome', question: '' }, ...QUESTIONS_DATA.questions, { id: 'done', question: '' }];
      screens = qs;
      const container = document.getElementById('screens');
      qs.forEach((q, i) => container.appendChild(renderScreen(q, i)));
      goTo(0);
      document.getElementById('nav-bar').classList.remove('d-none');
    }

    function goTo(idx) {
      document.querySelectorAll('.screen').forEach((s, i) => {
        s.classList.remove('active', 'prev', 'next');
        if (i === idx) s.classList.add('active');
        else if (i < idx) s.classList.add('prev');
        else s.classList.add('next');
      });
      currentIdx = idx;
      const q = screens[idx];
      const backBtn = document.getElementById('btn-back');
      const nextBtn = document.getElementById('btn-next');
      backBtn.style.display = idx <= 1 ? 'none' : 'flex';
      nextBtn.textContent = idx === screens.length - 1 ? 'Submit' : 'Next';
      nextBtn.className = 'nav-btn next' + (idx === screens.length - 1 ? ' submit' : '');
      nextBtn.disabled = false;
    }

    function collectCurrent() {
      const screen = document.querySelector('.screen.active');
      if (!screen) return;
      const qid = screen.dataset.qid;
      if (!qid || qid === 'welcome' || qid === 'done') return;
      const q = QUESTIONS_DATA.questions.find(x => x.id === qid);
      if (!q) return;
      const opts = screen.querySelectorAll('.option-btn.selected');
      const text = screen.querySelector('.text-input, textarea');
      const multi = screen.querySelectorAll('input[type="text"], select');
      if (q.expected_type === 'array' && q.options && q.options.length) {
        responses[qid] = Array.from(opts).map(o => o.dataset.value);
      } else if (q.expected_type === 'string' && q.options && q.options.length) {
        const sel = screen.querySelector('.option-btn.selected');
        responses[qid] = sel ? sel.dataset.value : null;
      } else if (q.expected_type === 'boolean') {
        const sel = screen.querySelector('.option-btn.selected');
        responses[qid] = sel ? sel.dataset.value === 'Yes' : null;
      } else if (q.id === 'q_salary') {
        responses[qid] = { min: screen.querySelector('[name="q_salary_min"]')?.value || null, max: screen.querySelector('[name="q_salary_max"]')?.value || null, currency: screen.querySelector('[name="q_salary_currency"]')?.value || 'NZD', includes_super: screen.querySelector('[name="q_salary_includes_super"]')?.value || 'no' };
      } else if (text) {
        const v = text.value.trim();
        responses[qid] = (q.expected_type === 'array' && (!q.options || !q.options.length)) ? (v ? v.split(/[,;]/).map(s=>s.trim()).filter(Boolean) : []) : (v || null);
      }
      const fu = screen.querySelector('[name$="_followup"]');
      if (fu && fu.value) responses[qid + '_followup'] = fu.value;
    }

    document.getElementById('btn-back').addEventListener('click', () => {
      if (currentIdx > 0) goTo(currentIdx - 1);
    });

    document.getElementById('btn-next').addEventListener('click', () => {
      collectCurrent();
      if (currentIdx < screens.length - 1) goTo(currentIdx + 1);
      else {
        const out = { candidate: QUESTIONS_DATA.candidate, responses };
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([JSON.stringify(out, null, 2)], { type: 'application/json' }));
        a.download = 'mcc-enrichment-responses.json';
        a.click();
        URL.revokeObjectURL(a.href);
      }
    });

    let touchStartX = 0;
    document.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; }, { passive: true });
    document.addEventListener('touchend', e => {
      const dx = e.changedTouches[0].clientX - touchStartX;
      if (Math.abs(dx) > 60) {
        if (dx > 0 && currentIdx > 0) goTo(currentIdx - 1);
        else if (dx < 0 && currentIdx < screens.length - 1) { collectCurrent(); goTo(currentIdx + 1); }
      }
    }, { passive: true });

    init();
  </script>
</body>
</html>
